
1585  **********************************************************************;
1586  * Project           : JACLS-ALL02
1587  *
1588  * Program name      : JACLS-ALL02_SDTM_DM.sas
1589  *
1590  * Author            : MATSUO YAMAMOTO
1591  *
1592  * Date created      : 20170330
1593  *
1594  * Purpose           : Create DM DataSet
1595  *
1596  * Revision History  :
1597  *
1598  * Date        Author           Ref    Revision (Date in YYYYMMDD format)
1599  *
1600  *
1601  **********************************************************************;
1602
1603  /*** Initial setting ***/
1604  %MACRO CURRENT_DIR;
1605
1606      %LOCAL _FULLPATH _PATH;
1607      %LET   _FULLPATH = ;
1608      %LET   _PATH     = ;
1609
1610      %IF %LENGTH(%SYSFUNC(GETOPTION(SYSIN))) = 0 %THEN
1611          %LET _FULLPATH = %SYSGET(SAS_EXECFILEPATH);
1612      %ELSE
1613          %LET _FULLPATH = %SYSFUNC(GETOPTION(SYSIN));
1614
1615      %LET _PATH = %SUBSTR(   &_FULLPATH., 1, %LENGTH(&_FULLPATH.)
1616                            - %LENGTH(%SCAN(&_FULLPATH.,-1,'\')) -1 );
1617
1618      &_PATH.
1619
1620  %MEND CURRENT_DIR;
1621
1622  %LET _PATH2 = %CURRENT_DIR;
1623  %LET FILE = dm;
1624
1625  %INCLUDE "&_PATH2.\JACLS-ALL02_SDTM_LIBNAME.sas";
NOTE: WORK.MAIN (memtype=DATA)を削除します。
NOTE: WORK.SASMACR (memtype=CATALOG)を削除します。
NOTE: ファイルWORK.SASMACR (memtype=CATALOG)は使用中なので削除できません。
NOTE: WORK.WK01 (memtype=DATA)を削除します。
NOTE: WORK.WK10 (memtype=DATA)を削除します。

NOTE: PROCEDURE DATASETS処理(合計処理時間):
      処理時間           0.10 秒
      CPU時間            0.07 秒


NOTE: ライブラリ参照名LIBRAWを次のように割り当てました。
      エンジン: V9
      物理名: C:\Users\MatsuoYamamoto\Desktop\GitHub\knonc_mapping\JACLS-ALL02\input\rawdata
NOTE: ライブラリ参照名LIBEXTを次のように割り当てました。
      エンジン: V9
      物理名: C:\Users\MatsuoYamamoto\Desktop\GitHub\knonc_mapping\JACLS-ALL02\input\ext
NOTE: ライブラリ参照名LIBSDTMを次のように割り当てました。
      エンジン: V9
      物理名: C:\Users\MatsuoYamamoto\Desktop\GitHub\knonc_mapping\JACLS-ALL02\output\sdtm
1686
1687  /*** CSV read ***/
1688  PROC IMPORT OUT= MAIN
1689    DATAFILE="&RAW.\ALL-02_OSEFSdata v1.csv"
1690    DBMS=CSV REPLACE;
1691    GETNAMES=NO;
1692    DATAROW=1;
1693    GUESSINGROWS=5000;
1694  RUN;

1695   /**********************************************************************
1696   *   プロダクト:   SAS
1697   *   バージョン:   9.4
1698   *   作成者:   外部ファイルインターフェイス
1699   *   作成日:      30MAR17
1700   *   説明:      生成された SAS データステップコード
1701   *   テンプレート ソース:  (指定なし)
1702   ***********************************************************************/
1703      data WORK.MAIN    ;
1704      %let _EFIERR_ = 0; /* エラー検出のマクロ変数を設定します */
1705      infile
1705! 'C:\Users\MatsuoYamamoto\Desktop\GitHub\knonc_mapping\JACLS-ALL02\input\rawdata\ALL-02_OSEFSda
1705! ta v1.csv' delimiter = ',' MISSOVER DSD lrecl=32767 ;
1706         informat VAR1 $3. ;
1707         informat VAR2 $18. ;
1708         informat VAR3 best32. ;
1709         informat VAR4 best32. ;
1710         informat VAR5 $2. ;
1711         informat VAR6 $2. ;
1712         informat VAR7 $2. ;
1713         informat VAR8 $1. ;
1714         informat VAR9 yymmdd10. ;
1715         informat VAR10 best32. ;
1716         informat VAR11 $10. ;
1717         informat VAR12 best32. ;
1718         informat VAR13 $2. ;
1719         informat VAR14 yymmdd10. ;
1720         informat VAR15 yymmdd10. ;
1721         informat VAR16 yymmdd10. ;
1722         informat VAR17 best32. ;
1723         informat VAR18 $8. ;
1724         informat VAR19 $83. ;
1725         informat VAR20 $314. ;
1726         informat VAR21 best32. ;
1727         informat VAR22 $4. ;
1728         informat VAR23 best32. ;
1729         informat VAR24 $24. ;
1730         informat VAR25 yymmdd10. ;
1731         informat VAR26 yymmdd10. ;
1732         informat VAR27 $358. ;
1733         informat VAR28 $25. ;
1734         informat VAR29 $8. ;
1735         informat VAR30 yymmdd10. ;
1736         informat VAR31 best32. ;
1737         informat VAR32 yymmdd10. ;
1738         informat VAR33 best32. ;
1739         informat VAR34 yymmdd10. ;
1740         informat VAR35 best32. ;
1741         informat VAR36 yymmdd10. ;
1742         informat VAR37 best32. ;
1743         informat VAR38 yymmdd10. ;
1744         informat VAR39 best32. ;
1745         informat VAR40 yymmdd10. ;
1746         informat VAR41 $81. ;
1747         informat VAR42 best32. ;
1748         informat VAR43 $8. ;
1749         informat VAR44 yymmdd10. ;
1750         informat VAR45 best32. ;
1751         informat VAR46 $40. ;
1752         informat VAR47 yymmdd10. ;
1753         informat VAR48 best32. ;
1754         informat VAR49 $8. ;
1755         informat VAR50 yymmdd10. ;
1756         informat VAR51 yymmdd10. ;
1757         informat VAR52 best32. ;
1758         informat VAR53 $4. ;
1759         informat VAR54 yymmdd10. ;
1760         informat VAR55 $17. ;
1761         informat VAR56 best32. ;
1762         informat VAR57 $8. ;
1763         informat VAR58 $100. ;
1764         informat VAR59 $536. ;
1765         format VAR1 $3. ;
1766         format VAR2 $18. ;
1767         format VAR3 best12. ;
1768         format VAR4 best12. ;
1769         format VAR5 $2. ;
1770         format VAR6 $2. ;
1771         format VAR7 $2. ;
1772         format VAR8 $1. ;
1773         format VAR9 yymmdd10. ;
1774         format VAR10 best12. ;
1775         format VAR11 $10. ;
1776         format VAR12 best12. ;
1777         format VAR13 $2. ;
1778         format VAR14 yymmdd10. ;
1779         format VAR15 yymmdd10. ;
1780         format VAR16 yymmdd10. ;
1781         format VAR17 best12. ;
1782         format VAR18 $8. ;
1783         format VAR19 $83. ;
1784         format VAR20 $314. ;
1785         format VAR21 best12. ;
1786         format VAR22 $4. ;
1787         format VAR23 best12. ;
1788         format VAR24 $24. ;
1789         format VAR25 yymmdd10. ;
1790         format VAR26 yymmdd10. ;
1791         format VAR27 $358. ;
1792         format VAR28 $25. ;
1793         format VAR29 $8. ;
1794         format VAR30 yymmdd10. ;
1795         format VAR31 best12. ;
1796         format VAR32 yymmdd10. ;
1797         format VAR33 best12. ;
1798         format VAR34 yymmdd10. ;
1799         format VAR35 best12. ;
1800         format VAR36 yymmdd10. ;
1801         format VAR37 best12. ;
1802         format VAR38 yymmdd10. ;
1803         format VAR39 best12. ;
1804         format VAR40 yymmdd10. ;
1805         format VAR41 $81. ;
1806         format VAR42 best12. ;
1807         format VAR43 $8. ;
1808         format VAR44 yymmdd10. ;
1809         format VAR45 best12. ;
1810         format VAR46 $40. ;
1811         format VAR47 yymmdd10. ;
1812         format VAR48 best12. ;
1813         format VAR49 $8. ;
1814         format VAR50 yymmdd10. ;
1815         format VAR51 yymmdd10. ;
1816         format VAR52 best12. ;
1817         format VAR53 $4. ;
1818         format VAR54 yymmdd10. ;
1819         format VAR55 $17. ;
1820         format VAR56 best12. ;
1821         format VAR57 $8. ;
1822         format VAR58 $100. ;
1823         format VAR59 $536. ;
1824      input
1825                  VAR1 $
1826                  VAR2 $
1827                  VAR3
1828                  VAR4
1829                  VAR5 $
1830                  VAR6 $
1831                  VAR7 $
1832                  VAR8 $
1833                  VAR9
1834                  VAR10
1835                  VAR11 $
1836                  VAR12
1837                  VAR13 $
1838                  VAR14
1839                  VAR15
1840                  VAR16
1841                  VAR17
1842                  VAR18 $
1843                  VAR19 $
1844                  VAR20 $
1845                  VAR21
1846                  VAR22 $
1847                  VAR23
1848                  VAR24 $
1849                  VAR25
1850                  VAR26
1851                  VAR27 $
1852                  VAR28 $
1853                  VAR29 $
1854                  VAR30
1855                  VAR31
1856                  VAR32
1857                  VAR33
1858                  VAR34
1859                  VAR35
1860                  VAR36
1861                  VAR37
1862                  VAR38
1863                  VAR39
1864                  VAR40
1865                  VAR41 $
1866                  VAR42
1867                  VAR43 $
1868                  VAR44
1869                  VAR45
1870                  VAR46 $
1871                  VAR47
1872                  VAR48
1873                  VAR49 $
1874                  VAR50
1875                  VAR51
1876                  VAR52
1877                  VAR53 $
1878                  VAR54
1879                  VAR55 $
1880                  VAR56
1881                  VAR57 $
1882                  VAR58 $
1883                  VAR59 $
1884      ;
1885      if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable */
1886      run;

NOTE: 入力ファイル'C:\Users\MatsuoYamamoto\Desktop\GitHub\knonc_mapping\JACLS-ALL02\input\rawdata\AL
      L-02_OSEFSdata v1.csv' :

      ファイル名=C:\Users\MatsuoYamamoto\Desktop\GitHub\knonc_mapping\JACLS-ALL02\input\rawdata\ALL-
      02_OSEFSdata v1.csv,
      レコードフォーマット=V,論理レコード長=32767,
      ファイルサイズ (バイト)=239443,
      更新日時=2017年01月18日 14時09分06秒,
      作成日時=2017年03月30日 13時10分19秒

NOTE: 1252レコードを入力ファイル'C:\Users\MatsuoYamamoto\Desktop\GitHub\knonc_mapping\JACLS-ALL02\in
      put\rawdata\ALL-02_OSEFSdata v1.csv'から読み込みました。
      最小レコード長は119です。
      最大レコード長は789です。
NOTE: データセットWORK.MAINは1252オブザベーション、59変数です。
NOTE: DATAステートメント処理(合計処理時間):
      処理時間           0.62 秒
      CPU時間            0.54 秒


1252 行が WORK.MAIN に
C:\Users\MatsuoYamamoto\Desktop\GitHub\knonc_mapping\JACLS-ALL02\input\rawdata\ALL-02_OSEFSdata
v1.csv から作成されました。



NOTE: WORK.MAINデータセットが正常に作成されました。
NOTE: データセットWORK.MAINは1252オブザベーション、59変数です。
NOTE: PROCEDURE IMPORT処理(合計処理時間):
      処理時間           9.67 秒
      CPU時間            8.79 秒


1887
1888  /*** Extraction of mapping target ***/
1889  DATA  WK01;
1890    SET  MAIN;
1891    IF  VAR1 = "0"; ***Eligibility only ;
1892  RUN ;

NOTE: データセットWORK.MAINから1252オブザベーションを読み込みました。
NOTE: データセットWORK.WK01は1245オブザベーション、59変数です。
NOTE: DATAステートメント処理(合計処理時間):
      処理時間           0.05 秒
      CPU時間            0.04 秒


1893
1894  /*** Mapping ***/
1895  DATA  WK10;
1896    LENGTH ARMCD ACTARMCD $20. ARM ACTARM $200.;
1897    SET  WK01;
1898    STUDYID = "JACLS-ALL02";
1899    DOMAIN = "DM";
1900    USUBJID = COMPRESS(STUDYID)||"-"||COMPRESS(PUT(VAR3,Z4.));
1901    SUBJID = COMPRESS(PUT(VAR3,BEST.));
1902    RFSTDTC = "";
1903    BRTHDTC = "";
1904    AGE = VAR10;
1905    AGEU = "YEARS";
1906    IF  VAR12 = 0 THEN SEX = "M";
1907    ELSE IF VAR12 = 1 THEN SEX = "F";
1908    ELSE SEX = "U";
1909
1910    *** Set ARMCD and ARM;
1911    IF VAR6 = "HR" AND VAR8 = "A" THEN DO; ARMCD = "SR-02A"; ARM = "SR-02A"; END;
1912    ELSE IF VAR6 = "HR" AND VAR8 = "B" THEN DO; ARMCD = "SR-02B"; ARM = "SR-02B"; END;
1913    ELSE IF VAR6 = "HR" AND VAR8 = "" THEN DO; ARMCD = "INDFAIL"; ARM = "Induction Failure"; END
1913! ;
1914    ELSE IF VAR6 = "SR" AND VAR8 = "A" THEN DO; ARMCD = "HR-02A"; ARM = "HR-02A"; END;
1915    ELSE IF VAR6 = "SR" AND VAR8 = "B" THEN DO; ARMCD = "HR-02B"; ARM = "HR-02B"; END;
1916    ELSE IF VAR6 = "SR" AND VAR8 = "" THEN DO; ARMCD = "INDFAIL"; ARM = "Induction Failure"; END
1916! ;
1917    ELSE IF VAR6 = "ER" THEN DO; ARMCD = "ER-02"; ARM = "ER-02"; END;
1918    ELSE IF VAR6 = "F" THEN DO; ARMCD = "F-02"; ARM = "F-02"; END;
1919    ELSE IF VAR6 = "T" THEN DO; ARMCD = "T-02"; ARM = "T-02"; END;
1920    ELSE IF VAR6 = ""  THEN DO; ARMCD = "INDFAIL"; ARM = "Induction Failure"; END;
1921    ELSE DO; ARMCD = "U"; ARM = "Unknown"; END;
1922
1923    *** Set ACTARMCD and ACTARM;
1924    IF  ARMCD="SR-02B" AND VAR2 = "割付けBだがAで治療" THEN DO; ACTARMCD = "SR-02A"; ACTARM =
1924! "SR-02A"; END;
1925    ELSE IF  ARMCD="HR-02B" AND VAR2 = "割付けBだがAで治療" THEN DO; ACTARMCD = "HR-02A"; ACTARM
1925!  = "HR-02A"; END;
1926    ELSE DO; ACTARMCD = ARMCD; ACTARM = ARM; END;
1927
1928    COUNTRY = "JPN";
1929    RFXSTDTC = PUT(VAR15,IS8601DA.);
1930    RFICDTC = "";
1931    DROP VAR:;
1932  RUN ;

NOTE: データセットWORK.WK01から1245オブザベーションを読み込みました。
NOTE: データセットWORK.WK10は1245オブザベーション、16変数です。
NOTE: DATAステートメント処理(合計処理時間):
      処理時間           0.14 秒
      CPU時間            0.15 秒


1933
1934  PROC SQL ;
1935     CREATE TABLE LIBSDTM.&FILE AS
1936     SELECT
1937      STUDYID  LENGTH=20    LABEL="Study Identifier",
1938      DOMAIN  LENGTH=2    LABEL="Domain Abbreviation",
1939      USUBJID  LENGTH=40    LABEL="Unique Subject Identifier",
1940      SUBJID  LENGTH=8    LABEL="Subject Identifier for the Study",
1941      RFSTDTC  LENGTH=19    LABEL="Subject Reference Start Date/Time",
1942      BRTHDTC  LENGTH=19    LABEL="Date/Time of Birth",
1943      AGE      LABEL="Age",
1944      AGEU  LENGTH=20    LABEL="Age Units",
1945      SEX  LENGTH=1    LABEL="Sex",
1946      ARMCD  LENGTH=20    LABEL="Planned Arm Code",
1947      ARM  LENGTH=200    LABEL="Description of Planned Arm",
1948      ACTARMCD   LENGTH=20    LABEL="Actual Arm Code ",
1949      ACTARM   LENGTH=200    LABEL="Description of Actual Arm ",
1950      COUNTRY  LENGTH=3    LABEL="Country",
1951      RFXSTDTC   LENGTH=19    LABEL="Date/Time of First Study Treatment ",
1952      RFICDTC   LENGTH=19    LABEL="Date/Time of Informed Consent "
1953     FROM WK10;
NOTE: テーブルLIBSDTM.DM(行数1245、列数16)が作成されました。

1954  QUIT ;
NOTE: PROCEDURE SQL処理(合計処理時間):
      処理時間           0.08 秒
      CPU時間            0.06 秒


1955
1956  FILENAME OUTF "&OUTPUT.\&FILE..csv" ;
1957
1958  PROC EXPORT DATA=LIBSDTM.&FILE. OUTFILE=OUTF
1959    DBMS=CSV REPLACE;
1960  RUN ;

1961   /**********************************************************************
1962   *   プロダクト:   SAS
1963   *   バージョン:   9.4
1964   *   作成者:   外部ファイルインターフェイス
1965   *   作成日:      30MAR17
1966   *   説明:      生成された SAS データステップコード
1967   *   テンプレート ソース:  (指定なし)
1968   ***********************************************************************/
1969      data _null_;
1970      %let _EFIERR_ = 0; /* エラー検出のマクロ変数を設定します */
1971      %let _EFIREC_ = 0;     /* エクスポートレコードカウントのマクロ変数をクリアします */
1972      file OUTF delimiter=',' DSD DROPOVER ;
1973      if _n_ = 1 then        /* 列名またはラベルを書き出します */
1974       do;
1975         put
1976            "STUDYID"
1977         ','
1978            "DOMAIN"
1979         ','
1980            "USUBJID"
1981         ','
1982            "SUBJID"
1983         ','
1984            "RFSTDTC"
1985         ','
1986            "BRTHDTC"
1987         ','
1988            "AGE"
1989         ','
1990            "AGEU"
1991         ','
1992            "SEX"
1993         ','
1994            "ARMCD"
1995         ','
1996            "ARM"
1997         ','
1998            "ACTARMCD"
1999         ','
2000            "ACTARM"
2001         ','
2002            "COUNTRY"
2003         ','
2004            "RFXSTDTC"
2005         ','
2006            "RFICDTC"
2007         ;
2008       end;
2009     set  LIBSDTM.DM   end=EFIEOD;
2010         format STUDYID $20. ;
2011         format DOMAIN $2. ;
2012         format USUBJID $40. ;
2013         format SUBJID $8. ;
2014         format RFSTDTC $19. ;
2015         format BRTHDTC $19. ;
2016         format AGE best12. ;
2017         format AGEU $20. ;
2018         format SEX $1. ;
2019         format ARMCD $20. ;
2020         format ARM $200. ;
2021         format ACTARMCD $20. ;
2022         format ACTARM $200. ;
2023         format COUNTRY $3. ;
2024         format RFXSTDTC $19. ;
2025         format RFICDTC $19. ;
2026       do;
2027         EFIOUT + 1;
2028         put STUDYID $ @;
2029         put DOMAIN $ @;
2030         put USUBJID $ @;
2031         put SUBJID $ @;
2032         put RFSTDTC $ @;
2033         put BRTHDTC $ @;
2034         put AGE @;
2035         put AGEU $ @;
2036         put SEX $ @;
2037         put ARMCD $ @;
2038         put ARM $ @;
2039         put ACTARMCD $ @;
2040         put ACTARM $ @;
2041         put COUNTRY $ @;
2042         put RFXSTDTC $ @;
2043         put RFICDTC $ ;
2044         ;
2045       end;
2046      if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable */
2047      if EFIEOD then call symputx('_EFIREC_',EFIOUT);
2048      run;

NOTE: 出力ファイルOUTF :
      ファイル名=C:\Users\MatsuoYamamoto\Desktop\GitHub\knonc_mapping\JACLS-ALL02\output\sdtm\dm.csv
      ,
      レコードフォーマット=V,論理レコード長=32767,
      ファイルサイズ (バイト)=0,
      更新日時=2017年03月30日 13時42分28秒,
      作成日時=2017年03月30日 13時42分28秒

NOTE: 1246レコードを出力ファイルOUTFに書き込みました。
      最小レコード長は73です。
      最大レコード長は117です。
NOTE: データセットLIBSDTM.DMから1245オブザベーションを読み込みました。
NOTE: DATAステートメント処理(合計処理時間):
      処理時間           0.28 秒
      CPU時間            0.26 秒


1245 レコードが OUTF に LIBSDTM.DM から作成されました。


NOTE: "OUTF" ファイルが正常に作成されました。
NOTE: PROCEDURE EXPORT処理(合計処理時間):
      処理時間           0.53 秒
      CPU時間            0.45 秒


2049
2050  %SDTM_FIN;

NOTE: DATAステートメント処理(合計処理時間):
      処理時間           0.00 秒
      CPU時間            0.01 秒


